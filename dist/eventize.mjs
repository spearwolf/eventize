/*!
 * =============================================================================
 * @spearwolf/eventize v0.6.6 -- https://github.com/spearwolf/eventize.git
 * =============================================================================
 *
 * Copyright 2015-2019 Wolfger Schramm <wolfger@spearwolf.de>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const e="*",t=1,r=2,s=4,i=Number.POSITIVE_INFINITY,n=1e9,a=1e6,l=1e3,o=0,c=-1e4,h=Number.NEGATIVE_INFINITY,f=(()=>(Symbol.eventize||(Symbol.eventize=Symbol("eventize")),Symbol.eventize))(),y=(e,t,r)=>{"function"==typeof t&&t.apply(e,r)},m=(e,t,r)=>y(t,t.emit,[e].concat(r)),p=e=>{switch(typeof e){case"function":return t;case"string":return r;case"object":return s}};let u=0;const A=()=>++u;class v{constructor(t,r,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.id=A(),this.eventName=t,this.isCatchEmAll=t===e,this.listener=s,this.listenerObject=i,this.priority=r,this.listenerType=p(s),this.callAfterApply=void 0,this.isRemoved=!1}isEqual(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t===this||("number"==typeof t&&t===this.id||(null===r&&"string"==typeof t?t===e||t===this.eventName:this.listener===t&&this.listenerObject===r))}apply(e,i){if(this.isRemoved)return;const n=this.listener,a=this.listenerObject;switch(this.listenerType){case t:y(a,n,i),this.callAfterApply&&this.callAfterApply();break;case r:y(a,a[n],i),this.callAfterApply&&this.callAfterApply();break;case s:{const t=n[e];(this.isCatchEmAll||this.eventName===e)&&("function"==typeof t?t.apply(n,i):m(e,n,i),this.callAfterApply&&this.callAfterApply());break}}}}const d=(e,t)=>e.priority!==t.priority?t.priority-e.priority:e.id-t.id,E=e=>{if(e)return e.slice(0)},g=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},b=(e,t,r)=>{const s=e.findIndex(e=>e.isEqual(t,r));s>-1&&(e[s].isRemoved=!0,e.splice(s,1))},L=e=>{e&&(e.forEach(e=>{e.isRemoved=!0}),e.length=0)};class w{constructor(){this.namedListeners=new Map,this.catchEmAllListeners=[]}add(e){if(e.isCatchEmAll)this.catchEmAllListeners.push(e),this.catchEmAllListeners.sort(d);else{const t=e.eventName;let r=this.namedListeners.get(t);r||(r=[],this.namedListeners.set(t,r)),r.push(e),r.sort(d)}}remove(t,r){if(null==r&&Array.isArray(t))t.forEach(this.remove.bind(this));else if(null==t||null==r&&t===e)this.removeAllListeners();else if(null==r&&"string"==typeof t){const e=this.namedListeners.get(t);L(e)}else t instanceof v?(t.isRemoved=!0,this.namedListeners.forEach(e=>g(e,t)),g(this.catchEmAllListeners,t)):(this.namedListeners.forEach(e=>b(e,t,r)),b(this.catchEmAllListeners,t,r))}removeAllListeners(){this.namedListeners.forEach(e=>L(e)),this.namedListeners.clear(),L(this.catchEmAllListeners)}forEach(t,r){const s=E(this.catchEmAllListeners),i=E(this.namedListeners.get(t));if(t!==e&&i&&0!==i.length)if(0===s.length)i.forEach(r);else{const e=i.length,t=s.length;let n=0,a=0;for(;n<e||a<t;){if(n<e){const e=i[n];if(a>=t||e.priority>=s[a].priority){r(e),++n;continue}}a<t&&(r(s[a]),++a)}}else s.forEach(r)}}class I{constructor(){this.events=new Map,this.eventNames=new Set}add(e){Array.isArray(e)?e.forEach(e=>this.eventNames.add(e)):this.eventNames.add(e)}remove(e){Array.isArray(e)?e.forEach(e=>this.remove(e)):this.eventNames.delete(e)}retain(e,t){this.eventNames.has(e)&&this.events.set(e,t)}isKnown(e){return this.eventNames.has(e)}emit(t,r){if(t===e)this.eventNames.forEach(e=>this.emit(e,r));else{const e=this.events.get(t);e&&r.apply(t,e)}}}const N=(e,t,r)=>(Object.defineProperty(e,t,{value:r,configurable:!0}),e);function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],s=!0,i=!1,n=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);s=!0);}catch(e){i=!0,n=e}finally{try{s||null==l.return||l.return()}finally{if(i)throw n}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}const R="undefined"!=typeof console,j=R?console[console.warn?"warn":"log"].bind(console,"[@spearwolf/eventize]"):()=>void 0,P=(t,r,s)=>{const i=s.length,n=typeof s[0];let a,l,o,c;if(i>=2&&i<=3&&"number"===n){a=e;var h=O(s,3);l=h[0],o=h[1],c=h[2]}else if(i>=3&&i<=4&&"number"==typeof s[1]){var f=O(s,4);a=f[0],l=f[1],o=f[2],c=f[3]}else if(l=0,"string"===n||Array.isArray(s[0])){var y=O(s,3);a=y[0],o=y[1],c=y[2]}else{a=e;var m=O(s,2);o=m[0],c=m[1]}if(!o&&R)return void j("called with insufficient arguments!",s);const p=e=>s=>((e,t,r,s,i,n)=>{const a=new v(r,s,i,n);return e.add(a),t.emit(r,a),a})(t,r,s,e,o,c);return Array.isArray(a)?a.map(e=>Array.isArray(e)?p(e[1])(e[0]):p(l)(e)):p(l)(a)},_=e=>t=>{t.callAfterApply=(()=>e.off(t))};function T(t){if(t[f])return t;const r=new w,s=new I;return N(t,f,{keeper:s,store:r}),Object.assign(t,{on(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return P(r,s,t)},once(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];const a=P(r,s,i);return Array.isArray(a)?a.forEach(_(t)):_(t)(a),a},off(e,t){r.remove(e,t),Array.isArray(e)?s.remove(e.filter(e=>"string"==typeof e)):"string"==typeof e&&s.remove(e)},emit(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];Array.isArray(t)?t.forEach(e=>{r.forEach(e,t=>t.apply(e,n)),s.retain(e,n)}):t!==e&&(r.forEach(t,e=>e.apply(t,n)),s.retain(t,n))},retain(e){s.add(e)}}),t}function S(e){return T(e)}S.inject=T,S.extend=(e=>T(Object.create(e))),S.create=(t=>{const r=T({});return r.on(e,0,t),r}),S.is=(e=>!(!e||!e[f])),Object.assign(S,{PRIO_MAX:i,PRIO_A:1e9,PRIO_B:1e6,PRIO_C:1e3,PRIO_DEFAULT:0,PRIO_LOW:-1e4,PRIO_MIN:h});export{S as eventize,e as EVENT_CATCH_EM_ALL,f as NAMESPACE,i as PRIO_MAX,n as PRIO_A,a as PRIO_B,l as PRIO_C,o as PRIO_DEFAULT,c as PRIO_LOW,h as PRIO_MIN};
//# sourceMappingURL=eventize.mjs.map
