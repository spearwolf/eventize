/*!
 * =============================================================================
 * eventize-js v1.0.0 -- https://github.com/spearwolf/eventize.git
 * =============================================================================
 *
 * Copyright 2015-2020 Wolfger Schramm <wolfger@spearwolf.de>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var e="*",t=Number.POSITIVE_INFINITY,r=1e9,i=1e6,s=1e3,n=0,a=-1e4,l=Number.NEGATIVE_INFINITY,h=(Symbol.eventize||(Symbol.eventize=Symbol("eventize")),Symbol.eventize),o=(e,t,r)=>{"function"==typeof t&&t.apply(e,r)},c=0;class f{constructor(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.id=++c,this.eventName=e,this.isCatchEmAll="*"===e,this.listener=r,this.listenerObject=i,this.priority=t,this.listenerType=(e=>{switch(typeof e){case"function":return 1;case"string":return 2;case"object":return 4}})(r),this.callAfterApply=void 0,this.isRemoved=!1}isEqual(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e===this||("number"==typeof e&&e===this.id||(null===t&&"string"==typeof e?"*"===e||e===this.eventName:this.listener===e&&this.listenerObject===t))}apply(e,t){if(!this.isRemoved){var{listener:r,listenerObject:i}=this;switch(this.listenerType){case 1:o(i,r,t),this.callAfterApply&&this.callAfterApply();break;case 2:o(i,i[r],t),this.callAfterApply&&this.callAfterApply();break;case 4:var s=r[e];(this.isCatchEmAll||this.eventName===e)&&("function"==typeof s?s.apply(r,t):((e,t,r)=>{o(t,t.emit,[e].concat(r))})(e,r,t),this.callAfterApply&&this.callAfterApply())}}}}var v=(e,t)=>e.priority!==t.priority?t.priority-e.priority:e.id-t.id,m=e=>{if(e)return e.slice(0)},y=(e,t)=>{var r=e.indexOf(t);r>-1&&e.splice(r,1)},p=(e,t,r)=>{var i=e.findIndex(e=>e.isEqual(t,r));i>-1&&(e[i].isRemoved=!0,e.splice(i,1))},A=e=>{e&&(e.forEach(e=>{e.isRemoved=!0}),e.length=0)};class d{constructor(){this.namedListeners=new Map,this.catchEmAllListeners=[]}add(e){if(e.isCatchEmAll)this.catchEmAllListeners.push(e),this.catchEmAllListeners.sort(v);else{var{eventName:t}=e,r=this.namedListeners.get(t);r||(r=[],this.namedListeners.set(t,r)),r.push(e),r.sort(v)}}remove(e,t){if(null==t&&Array.isArray(e))e.forEach(this.remove.bind(this));else if(null==e||null==t&&"*"===e)this.removeAllListeners();else if(null==t&&"string"==typeof e){var r=this.namedListeners.get(e);A(r)}else e instanceof f?(e.isRemoved=!0,this.namedListeners.forEach(t=>y(t,e)),y(this.catchEmAllListeners,e)):(this.namedListeners.forEach(r=>p(r,e,t)),p(this.catchEmAllListeners,e,t))}removeAllListeners(){this.namedListeners.forEach(e=>A(e)),this.namedListeners.clear(),A(this.catchEmAllListeners)}forEach(e,t){var r=m(this.catchEmAllListeners),i=m(this.namedListeners.get(e));if("*"!==e&&i&&0!==i.length)if(0===r.length)i.forEach(t);else for(var s=i.length,n=r.length,a=0,l=0;a<s||l<n;){if(a<s){var h=i[a];if(l>=n||h.priority>=r[l].priority){t(h),++a;continue}}l<n&&(t(r[l]),++l)}else r.forEach(t)}}class u{constructor(){this.events=new Map,this.eventNames=new Set}add(e){Array.isArray(e)?e.forEach(e=>this.eventNames.add(e)):this.eventNames.add(e)}remove(e){Array.isArray(e)?e.forEach(e=>this.remove(e)):this.eventNames.delete(e)}retain(e,t){this.eventNames.has(e)&&this.events.set(e,t)}isKnown(e){return this.eventNames.has(e)}emit(e,t){if("*"===e)this.eventNames.forEach(e=>this.emit(e,t));else{var r=this.events.get(e);r&&t.apply(e,r)}}}var E="undefined"!=typeof console,g=E?console[console.warn?"warn":"log"].bind(console,"[eventize]"):()=>{},b=(e,t,r)=>{var i,s,n,a,l=r.length,h=typeof r[0];if(l>=2&&l<=3&&"number"===h?(i="*",[s,n,a]=r):l>=3&&l<=4&&"number"==typeof r[1]?[i,s,n,a]=r:(s=0,"string"===h||Array.isArray(r[0])?[i,n,a]=r:(i="*",[n,a]=r)),n||!E){var o=r=>i=>((e,t,r,i,s,n)=>{var a=new f(r,i,s,n);return e.add(a),t.emit(r,a),a})(e,t,i,r,n,a);return Array.isArray(i)?i.map(e=>Array.isArray(e)?o(e[1])(e[0]):o(s)(e)):o(s)(i)}g("called with insufficient arguments!",r)},L=e=>t=>{t.callAfterApply=()=>e.off(t)};function N(e){if(e[h])return e;var t=new d,r=new u;return((e,t,r)=>{Object.defineProperty(e,t,{value:r,configurable:!0})})(e,h,{keeper:r,store:t}),Object.assign(e,{on(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return b(t,r,i)},once(){for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];var a=b(t,r,s);return Array.isArray(a)?a.forEach(L(e)):L(e)(a),a},off(e,i){t.remove(e,i),Array.isArray(e)?r.remove(e.filter(e=>"string"==typeof e)):"string"==typeof e&&r.remove(e)},emit(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];Array.isArray(e)?e.forEach(e=>{t.forEach(e,t=>t.apply(e,s)),r.retain(e,s)}):"*"!==e&&(t.forEach(e,t=>t.apply(e,s)),r.retain(e,s))},retain(e){r.add(e)}}),e}function I(e){return N(e)}I.inject=N,I.extend=e=>N(Object.create(e)),I.create=e=>{var t=N({});return t.on("*",0,e),t},I.is=e=>!(!e||!e[h]),Object.assign(I,{PRIO_MAX:t,PRIO_A:1e9,PRIO_B:1e6,PRIO_C:1e3,PRIO_DEFAULT:0,PRIO_LOW:-1e4,PRIO_MIN:l});export{e as EVENT_CATCH_EM_ALL,h as NAMESPACE,r as PRIO_A,i as PRIO_B,s as PRIO_C,n as PRIO_DEFAULT,a as PRIO_LOW,t as PRIO_MAX,l as PRIO_MIN,I as eventize};
//# sourceMappingURL=eventize.mjs.map
